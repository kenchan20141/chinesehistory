<!DOCTYPE html>
<html>
<head>
    <title>Brain Duel</title>
    <style>
        body {
            background: #1a1a1a;
            color: white;
            font-family: Arial;
            text-align: center;
        }
        .player-container {
            display: flex;
            justify-content: space-around;
            margin: 20px;
        }
        .health-bar {
            width: 300px;
            height: 30px;
            background: #333;
            border-radius: 15px;
            margin: 10px;
        }
        .health {
            height: 100%;
            background: #00ff00;
            border-radius: 15px;
            transition: width 0.3s;
        }
        .question-box {
            background: #333;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
        }
        .answer-btn {
            background: #444;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        .answer-btn:hover {
            background: #555;
        }
        .status {
            font-size: 24px;
            font-weight: bold;
            margin: 20px;
        }
    </style>
</head>
<body>
    <audio id="bgm" loop>
        <source src="https://assets.mixkit.co/active_storage/sfx/2593/2593-preview.mp3" type="audio/mpeg">
    </audio>
    
    <div class="player-container">
        <div>
            <div>Player 1</div>
            <div class="health-bar"><div class="health" id="health1"></div></div>
        </div>
        <div>
            <div>Player 2</div>
            <div class="health-bar"><div class="health" id="health2"></div></div>
        </div>
    </div>

    <div class="question-box" id="questionBox"></div>
    <div class="status" id="status"></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBi9IEquAN1JPQTA2FVylSheVCtuAG8ZoY",
  authDomain: "game-9e2a9.firebaseapp.com",
  databaseURL: "https://game-9e2a9-default-rtdb.firebaseio.com",
  projectId: "game-9e2a9",
  storageBucket: "game-9e2a9.firebasestorage.app",
  messagingSenderId: "567367988730",
  appId: "1:567367988730:web:6ff2ee6e0cddecfaa9e043"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let gameData = {};
        let startTime;
        const questions = [
            {
                question: "What is 2+2?",
                answers: ["3", "4", "5", "6"],
                correct: 1
            },
            {
                question: "Capital of Japan?",
                answers: ["Tokyo", "Osaka", "Kyoto", "Hiroshima"],
                correct: 0
            }
        ];

        document.addEventListener('click', () => document.getElementById('bgm').play());
        
        async function initGame() {
            const roomId = prompt("Enter room ID:");
            const gameRef = db.collection('games').doc(roomId);
            
            gameRef.onSnapshot(doc => {
                gameData = doc.data();
                updateUI();
                checkGameEnd();
            });

            if (!gameData.players) {
                await gameRef.set({
                    players: [1],
                    healths: [100, 100],
                    currentQuestion: null,
                    answers: []
                });
            } else {
                await gameRef.update({ players: [...gameData.players, 2] });
            }

            document.getElementById('questionBox').addEventListener('click', e => {
                if (e.target.classList.contains('answer-btn')) handleAnswer(e.target.dataset.index);
            });
        }

        function handleAnswer(answerIndex) {
            const answerTime = (Date.now() - startTime) / 1000;
            const damage = Math.max(10, 100 - Math.floor(answerTime * 10));
            
            db.collection('games').doc(gameData.roomId).update({
                answers: [...gameData.answers, answerIndex],
                healths: calculateDamage(answerIndex, damage)
            });
        }

        function calculateDamage(answerIndex, damage) {
            const correctIndex = questions[gameData.currentQuestion].correct;
            if (answerIndex == correctIndex) {
                return [gameData.healths[0], gameData.healths[1] - damage];
            }
            return [gameData.healths[0] - damage, gameData.healths[1]];
        }

        function updateUI() {
            document.getElementById('health1').style.width = `${gameData.healths[0]}%`;
            document.getElementById('health2').style.width = `${gameData.healths[1]}%`;
            
            if (gameData.currentQuestion !== null) {
                const q = questions[gameData.currentQuestion];
                document.getElementById('questionBox').innerHTML = `
                    <h3>${q.question}</h3>
                    ${q.answers.map((a, i) => `
                        <button class="answer-btn" data-index="${i}">${a}</button>
                    `).join('')}
                `;
                startTime = Date.now();
            }
        }

        function checkGameEnd() {
            if (gameData.healths[0] <= 0 || gameData.healths[1] <= 0) {
                document.getElementById('status').textContent = 
                    gameData.healths[0] > 0 ? "WIN" : "LOSE";
            }
        }

        initGame();
    </script>
</body>
</html>
